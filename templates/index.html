{% extends 'base.html' %}

{% block content %}
<div style="text-align: center; margin-top: 2rem;">
    <div class="card" style="max-width: 500px; margin: 0 auto; animation: bounce 2s infinite;">
        <div class="card-title">
            <i class="fas fa-qrcode"></i> QR Code Attendance Scanner
        </div>
        
        <div style="margin: 2rem 0;">
            <div class="qr-scanner">
                <div id="qrcode"></div>
            </div>
        </div>
        
        <div style="color: var(--gray-700); margin: 1.5rem 0; padding: 1rem; background: var(--gray-100); border-radius: 8px;">
            <i class="fas fa-info-circle"></i> Position QR code within the scanner frame
        </div>
    </div>
    
    <div id="student-details" class="card" style="max-width: 500px; margin: 2rem auto; display: none; animation: fadeIn 0.5s ease-out;">
        
    </div>
    
    <div style="margin-top: 2rem; color: var(--gray-700);">
        <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">
            <i class="fas fa-graduation-cap"></i> How to Use
        </h3>
        <div style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
            <div style="text-align: center; max-width: 200px;">
                <div style="width: 60px; height: 60px; background: var(--primary-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                    1
                </div>
                <div style="font-weight: 600;">Generate QR Code</div>
                <div style="font-size: 0.9rem; margin-top: 0.5rem;">Students get unique QR codes</div>
            </div>
            
            <div style="text-align: center; max-width: 200px;">
                <div style="width: 60px; height: 60px; background: var(--primary-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                    2
                </div>
                <div style="font-weight: 600;">Scan Code</div>
                <div style="font-size: 0.9rem; margin-top: 0.5rem;">Position QR code in scanner</div>
            </div>
            
            <div style="text-align: center; max-width: 200px;">
                <div style="width: 60px; height: 60px; background: var(--primary-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                    3
                </div>
                <div style="font-weight: 600;">Record Attendance</div>
                <div style="font-size: 0.9rem; margin-top: 0.5rem;">System automatically records attendance</div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/html5-qrcode.min.js') }}"></script>
<script>
    const html5QrcodeScanner = new Html5QrcodeScanner(
        "qrcode", 
        { 
            fps: 10,
            qrbox: { width: 250, height: 250 }
        },
        false
    );
    
    function onScanSuccess(decodedText, decodedResult) {
        console.log(`Scanned: ${decodedText}`);
        
        
        document.querySelector('.qr-scanner').style.animation = 'spin 0.5s linear';
        
        fetch('/check?idno=' + decodedText)
            .then(response => response.text())
            .then(data => {
                const detailsDiv = document.getElementById('student-details');
                detailsDiv.innerHTML = data;
                detailsDiv.style.display = 'block';
                
                
                document.querySelector('.qr-scanner').style.animation = 'scan 2s linear infinite';
                
                
                setTimeout(function() {
                    detailsDiv.style.display = 'none';
                    detailsDiv.innerHTML = '';
                }, 5000);
            })
            .catch(error => console.error(error));
        
        html5QrcodeScanner.clear();
    }
    
    html5QrcodeScanner.render(onScanSuccess);
    
    // Add pulsing effect to scanner border
    const scanner = document.querySelector('.qr-scanner');
    setInterval(() => {
        scanner.style.boxShadow = '0 0 20px rgba(37, 99, 235, 0.7)';
        setTimeout(() => {
            scanner.style.boxShadow = 'none';
        }, 500);
    }, 2000);
</script>
{% endblock %}