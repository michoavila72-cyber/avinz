{% extends 'base.html' %}

{% block content %}
<div style="background: var(--primary-color, #2c3e50); padding: 1.5rem 0; color: white; margin-bottom: 1.5rem;">
    <div style="max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; display: flex; justify-content: space-between; align-items: center;">
        
        <h1 style="margin: 0; font-size: 2rem; font-weight: 600;">Python (19877) 8:00 - 10:30 AM</h1>
        
        <a href="{{ url_for('logout') }}" style="color: white; text-decoration: none; font-weight: 600; padding: 0.5rem 1rem; border: 2px solid white; border-radius: 4px;">
            LOG-OUT
        </a>
    </div>
</div>

<div class="main-layout" style="max-width: 1200px; margin: 0 auto; padding: 0 1.5rem;">
    
    <div class="sidebar" style="background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); padding: 1rem 0; height: fit-content;">
        <div class="sidebar-title" style="font-weight: 600; color: #333; margin-bottom: 1rem; padding: 0 1rem; border-bottom: 1px solid #eee; padding-bottom: 1rem;">
            Menu
        </div>
        
        <nav class="nav-menu">
            
            <a href="{{ url_for('admin') }}" class="nav-item">
                <i class="fas fa-users-cog"></i> User Management
            </a>
            <a href="{{ url_for('student_mngt') }}" class="nav-item active">
                <i class="fas fa-user-graduate"></i> Student Management
            </a>
            <a href="{{ url_for('attend') }}" class="nav-item">
                <i class="fas fa-clipboard-check"></i> + Attendance
            </a>
            <a href="{{ url_for('logout') }}" class="nav-item" style="color: var(--dark-gray); margin-top: 1rem;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>
    </div>
    
    <div class="content-area">
        <div class="card" style="padding: 1.5rem; border: 1px solid #d0d7de; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: var(--primary-color, #2c3e50); font-size: 1.5rem; margin: 0;">
                    STUDENT MANAGEMENT
                </h2>
                <a href="{{ url_for('add_student_page') }}" class="btn btn-primary" style="padding: 0.5rem 1rem;">
                    + ADD
                </a>
            </div>

            <div style="display: flex; gap: 2rem;">
                
                <div style="width: 300px; flex-shrink: 0; background: #f9f9f9; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);">
                    <form method="POST" action="{{ url_for('student_mngt') }}" enctype="multipart/form-data">
                        <input type="hidden" name="edit_id" value="{{ edit_student.id if edit_student else '' }}">
                        
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <img src="{{ url_for('static', filename='images/' + (edit_student.avatar if edit_student and edit_student.avatar else 'default_avatar.png')) }}" 
                                 alt="Student Avatar" 
                                 style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-color, #2c3e50);">
                            <p style="margin-top: 5px; font-size: 0.8rem; color: #777;">Current Picture</p>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem; padding-top: 0.5rem; border-top: 1px solid #eee;">
                            <label for="profile_pic" style="font-weight: 600; display: block; margin-bottom: 5px;">Change Profile Picture</label>
                            <input type="file" id="profile_pic" name="profile_picture" accept="image/*"
                                   class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; height: auto;">
                            <div style="font-size: 0.8rem; color: #777; margin-top: 5px;">
                                Select a JPG, PNG or GIF image (max 2MB)
                            </div>
                        </div>
                        {% set s = edit_student %}
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="idno" style="font-weight: 600; display: block; margin-bottom: 5px;">IDNO</label>
                            <input type="text" id="idno" name="idno" value="{{ s.idno if s else '' }}" 
                                   class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" required>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="lastname" style="font-weight: 600; display: block; margin-bottom: 5px;">LASTNAME</label>
                            <input type="text" id="lastname" name="lastname" value="{{ s.lastname if s else '' }}" 
                                   class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" required>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="firstname" style="font-weight: 600; display: block; margin-bottom: 5px;">FIRSTNAME</label>
                            <input type="text" id="firstname" name="firstname" value="{{ s.firstname if s else '' }}" 
                                   class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" required>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="course" style="font-weight: 600; display: block; margin-bottom: 5px;">COURSE</label>
                            <select id="course" name="course" class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" required>
                                <option value="" disabled {% if not s or not s.course %}selected{% endif %}>Select Course</option>
                                <option value="BSIT" {% if s and s.course == 'BSIT' %}selected{% endif %}>BSIT</option>
                                <option value="BSCPE" {% if s and s.course == 'BSCPE' %}selected{% endif %}>BSCPE</option>
                                <option value="BSCS" {% if s and s.course == 'BSCS' %}selected{% endif %}>BSCS</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label for="level" style="font-weight: 600; display: block; margin-bottom: 5px;">LEVEL</label>
                            <select id="level" name="level" class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" required>
                                <option value="" disabled {% if not s or not s.level %}selected{% endif %}>Select Level</option>
                                <option value="1" {% if s and s.level == '1' %}selected{% endif %}>1</option>
                                <option value="2" {% if s and s.level == '2' %}selected{% endif %}>2</option>
                                <option value="3" {% if s and s.level == '3' %}selected{% endif %}>3</option>
                                <option value="4" {% if s and s.level == '4' %}selected{% endif %}>4</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.75rem; font-weight: 600;">
                            {{ 'EDIT' if edit_student else 'EDIT' }}
                        </button>
                    </form>
                </div>
                
                <div style="flex: 1; min-width: 0;">
                    <div style="overflow-x: auto;">
                        <table class="table data-table" style="width: 100%; border: 1px solid #000; border-collapse: collapse; margin-top: 0;">
                            <thead>
                                <tr>
                                    <th style="text-align: left; padding: 10px; border: 1px solid #000; border-top: none;">ID</th>
                                    <th style="text-align: left; padding: 10px; border: 1px solid #000; border-top: none;">IDNO</th>
                                    <th style="text-align: left; padding: 10px; border: 1px solid #000; border-top: none;">LASTNAME</th>
                                    <th style="text-align: left; padding: 10px; border: 1px solid #000; border-top: none;">FIRSTNAME</th>
                                    <th style="text-align: left; padding: 10px; border: 1px solid #000; border-top: none;">COURSE</th>
                                    <th style="text-align: left; padding: 10px; border: 1px solid #000; border-top: none;">LEVEL</th>
                                    <th style="text-align: center; padding: 10px; border: 1px solid #000; border-top: none;">ACTION</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if students %}
                                    {% for student in students %}
                                    <tr>
                                        <td style="font-weight: 400; color: #333; padding: 10px; border: 1px solid #000; border-bottom: none;">
                                            {{ loop.index }}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #000; border-bottom: none;">
                                            {{ student.idno }}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #000; border-bottom: none;">
                                            {{ student.lastname }}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #000; border-bottom: none;">
                                            {{ student.firstname }}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #000; border-bottom: none;">
                                            {{ student.course }}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #000; border-bottom: none;">
                                            {{ student.level }}
                                        </td>
                                        <td style="padding: 10px; text-align: center; border: 1px solid #000; border-bottom: none; display: flex; gap: 5px; justify-content: center;">
                                            <a href="{{ url_for('student_mngt', edit_id=student.id) }}" title="Edit" class="btn btn-sm" style="padding: 5px 10px;">
                                                <i class="fas fa-edit" style="color: blue;"></i>
                                            </a>
                                            <a href="{{ url_for('delete_student', student_id=student.id) }}" 
                                               onclick="return confirm('Are you sure you want to delete this student?');" 
                                               title="Delete" class="btn btn-sm" style="padding: 5px 10px;">
                                                <i class="fas fa-trash" style="color: red;"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 20px; color: #7f8c8d; border: 1px solid #000; border-bottom: none;">
                                            No student records found.
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* General layout and card styles */
    .main-layout {
        display: flex;
        gap: 1.5rem;
    }
    .sidebar {
        width: 250px;
        flex-shrink: 0;
    }
    .content-area {
        flex: 1;
        min-width: 0;
    }
    .card {
        background: white;
        border-radius: var(--border-radius, 8px);
    }
    
    /* Sidebar specific styling */
    .nav-menu {
        display: flex;
        flex-direction: column;
    }
    .nav-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 1rem;
        text-decoration: none;
        color: #333;
        transition: background-color 0.2s;
        font-size: 0.95rem;
    }
    .nav-item:hover {
        background-color: #f0f0f0;
    }
    .nav-item.active {
        background-color: var(--secondary-color, #3498db);
        color: white !important;
        font-weight: 600;
    }
    .nav-item.active i {
        color: white !important;
    }

    /* Form and Table specific styling */
    .form-control {
        padding: 8px 10px;
        border-radius: 4px;
        font-size: 1rem;
    }

    /* Responsive adjustment */
    @media (max-width: 1024px) {
        .main-layout {
            flex-direction: column;
        }
        .sidebar {
            width: 100%;
        }
        .card > div:nth-child(2) { /* Targeting the flex container for the two columns */
            flex-direction: column;
        }
        .card > div:nth-child(2) > div:first-child { /* Targeting the left column (form) */
            width: 100% !important;
        }
    }
</style>
{% endblock %}